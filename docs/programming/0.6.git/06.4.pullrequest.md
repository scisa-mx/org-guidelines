#  Pull Requests: formato, checklist, aprobaciones

Un Pull Request (PR) no es un trámite; es un punto de control de calidad y un contrato entre quien propone el cambio y quien lo valida. El objetivo es que revisar sea fácil, seguro y eficiente.

## Puntos clave de un Pull request
Un pull requets debe de "facilitar, no pedir permiso"
Si un PR es difícil de revisar, la responsabilidad recae en el autor, no en el revisor. Un PR bien ejecutado reduce bugs, acelera el despliegue y mantiene sano el historial del proyecto.

Algunos puntos o buenas prácticas a tener en cuenta son:

- Tamaño y alcance.
- Calidad del código.
- Formato y estructura.

### Tamaño y alcance

Un error común es hacer un PR "Frankestein" en donde se depositan múltiples cambios no relacionados. Esto dificulta la revisión y aumenta la probabilidad de errores.
Para evitarlo, establecemos límites que aseguren una revisión cognitiva sana.

- Atomicidad Conceptual: Un PR debe responder a una sola pregunta: "¿Qué arregla esto?". Si la respuesta incluye un "y también...", probablemente deban ser dos PRs distintos.
- El impacto del tamaño: 
    - **PR pequeño:** Revisión profunda, feedback constructivo, merge rápido.
    - **PR gigante:** Revisión superficial (el clásico "LGTM" por fatiga), alto riesgo de bugs, conflictos de merge infinitos.

Claramente esto puede ser flexible según el contexto del PR y la implementación que se haga, pero hay que tener en cuenta cierto límite de tolerancia para evitar problemas como la poca legibilidad o dificultad de revisión y testeo.

### Calidad del código

No revisamos solo si "funciona", revisamos si es mantenible. En este apartado, el autor debe garantizar:


| Criterio          | Expectativa                                                                              | 
|-------------------|------------------------------------------------------------------------------------------|
| Legibilidad       | "El código se explica solo. Si necesitas un comentario para explicar                     |
|                   |  qué hace el código, refactoriza. Si es para explicar por qué, el comentario es válido " |
|--------------------------------------------------------------------------------------------------------------|
| Principios SOLID  | ¿Estamos rompiendo la responsabilidad única? ¿Estamos introduciendo                      |
|                   |  acoplamiento innecesario o lógica donde no corresponde?                                 |
|-------------------|------------------------------------------------------------------------------------------|
| Manejo de Errores | "No solo el "camino feliz". ¿Qué pasa si la API falla?                                   |
|                   |  ¿Qué pasa si el dato es nulo o el servicio no responde?"                                |
|-------------------|------------------------------------------------------------------------------------------|
| Deuda Técnica     | "No se permite el "lo arreglo luego" sin rastro. Si introduces una                       |
|                   |  solución temporal, debe estar marcada con un TODO y un ticket asociado."                |

### Formato y estructura

Crear una plantilla para el proyecto en cuestión puede ayudar a estandarizar los PRs y facilitar la revisión. puede mejorar enormemente el proceso de desarrollo, garantizando una comunicación consistente y revisiones eficientes. Con la plantilla de PR adecuada, los desarrolladores de software pueden optimizar las contribuciones, ahorrando tiempo y reduciendo errores. 

Puede que cada equipo y cada proyecto tenga diferentes necesidades, y por lo tanto pueda variar el contenido de la planmtilla para ajustarse a esas necesidades específicas. Inclusive algunas ocaciones puede funcionar simplemente dejar la lista de chequeo y de commits realizados. (Considerando que al menos de ha dejado una buena descripción de los commits como en la guia de [commits](./06.3.commits_rules.md)).

Una plantilla de PR bien diseñada aporta una multitud de ventajas al flujo de trabajo de desarrollo:

- **Coherencia:** las plantillas de PR establecen un estándar para todas las contribuciones, lo que facilita la revisión y la comprensión de las solicitudes de extracción.
- **Claridad:** Las plantillas incitan a los colaboradores a incluir toda la información necesaria, lo que aclara el propósito y el contexto de la solicitud de relaciones públicas.
- **Control de calidad:** la incorporación de listas de verificación y pautas puede mejorar la calidad general del código y la documentación.
- **Eficiencia:** La información estructurada permite a los miembros dedicar menos tiempo a descifrar los informes y más tiempo a evaluar los cambios propuesto

### Mejores prácticas para las plantillas de relaciones públicas

- **Mantenlo simple:** Evita complicar demasiado la plantilla. Incluye solo las secciones realmente necesarias para que tu equipo evalúe el PR.
- **Sea específico:** Adapta las indicaciones y las listas de verificación a los requisitos de su proyecto para evitar información genérica o irrelevante.
- **Guiar al usuario:** utilice comentarios para brindar instrucciones o ejemplos a los colaboradores sin saturar la descripción visible del PR.
- **Garantiza la escalabilidad:** A medida que tu proyecto crece, también puede crecer tu plantilla. Revísala y ajústala periódicamente para que se ajuste a las necesidades cambiantes del proyecto.

### Errores comunes que se deben evitar en las plantillas de relaciones públicas

- **Sobrecarga de información:** Demasiados detalles pueden abrumar a los colaboradores. Procure mantener el equilibrio al brindar orientación.
- **Ser demasiado vago:** Por el contrario, ser demasiado genérico puede dar lugar a que los textos que se envíen carezcan de información o contexto vital.
- **Resistencia al cambio:** La flexibilidad es crucial. No te apegues a un modelo que no funciona bien solo porque ha sido el estándar.

### Ejemplos de plantilla para PRs

#### Plantilla `Feature addition`

```markdown
# Titulo
<tipo>(<scope>): <intención del cambio>

## Contexto
¿Por qué es necesario este cambio?

## Qué se hizo
Resumen técnico de los cambios.

## Qué NO se hizo
Alcance explícitamente excluido. (Si aplica)

## Cómo probarlo
Pasos claros para validar el cambio.

## Notas adicionales

Cualquier información adicional para el PR.

## Checklist para el autor.
Antes de pasar a revisión, el autor debe validar:
- [ ] El PR responde a una sola pregunta o problema.
- [ ] El código es legible y sigue los principios SOLID.
(Estos checks son de ejemplo, varia entre PRs)

## Changelog 
Los cambios en el changelog que se reflejan en el PR.
```

#### Ejemplo de `Feature addition`
```markdown
# FEAT(Orders): Prevención de cancelación de órdenes enviadas

## Contexto
Currently, orders can be cancelled even after being shipped,
causing inconsistencies with inventory and billing.

## Qué se hizo
- Added status validation in Order domain
- Updated cancellation flow
- Added unit tests for shipped orders

## Qué NO se hizo
- No changes to refund logic
- No changes to UI

## Cómo probarlo
1. Create an order
2. Mark it as shipped
3. Attempt cancellation → should fail

## Notas adicionales
This change requires a database migration to add the new status field.

## Changelog
### Versión 1.2.0
#### Changes
- Prevent order cancellation after shipment
...

```

#### Referencias
[Comprehensive Checklist: GitHub PR Template by Greg Foster](https://graphite.com/guides/comprehensive-checklist-github-pr-template)
[How to Make a Perfect Pull Request by Anton Chuchkalov](https://medium.com/better-programming/how-to-make-a-perfect-pull-request-3578fb4c112)

## Checklist obligatorio del PR

Este checklist es responsabilidad del autor, no del revisor.

### Checklist técnico
- Los commits son atómicos y entendibles
- El historial fue limpiado (rebase/squash) si aplica
- No hay cambios fuera del alcance del PR
- El código sigue los estándares del proyecto
- No hay código comentado o temporal
- No hay logs de debug

### Checklist de calidad
- Hay tests nuevos o ajustados (si aplica)
- Los tests pasan localmente
- No se rompe compatibilidad existente
- Se consideraron escenarios de error

### Checklist de arquitectura
- El cambio respeta principios SOLID
- No se introduce acoplamiento innecesario
- La responsabilidad está bien ubicada
- No se filtra lógica de dominio a capas incorrectas

## Roles
### Rol del autor del PR
Es quien propone el cambio y debe garantizar su calidad antes de solicitar revisión. Quien abre el PR es responsable de su calidad.

**Esto implica:**
- Preparar el PR para revisión
- Anticipar preguntas
- Explicar decisiones no obvias
- Responder comentarios con contexto técnico

**Un PR no es:**
- “Ahí está, tú dime”
- “Si falla algo luego vemos”


### Rol del revisor
Es quien valida el cambio propuesto. Consideremos que revisar es una responsabilidad técnica, no una cortesía.

**El revisor debe:**

- Leer el PR completo
- Revisar commit por commit
- Evaluar diseño, no solo sintaxis
- Señalar riesgos futuros

**Qué revisar primero:**
- Intención del PR
- Diseño y arquitectura
- Legibilidad
- Tests
- Detalles menores
- No empezar por tabs, nombres o estilos.

## Aprobaciones

**Reglas base**
- Todo PR requiere al menos una aprobación
- Cambios críticos requieren dos aprobaciones
- El autor no puede auto-aprobar

**Cuándo NO aprobar**

- El PR no tiene contexto
- Hay commits confusos
- Hay dudas de diseño sin resolver
- El revisor no entiende el cambio
- “No entiendo” es una razón válida para bloquear un PR.
- Aprobación con comentarios
- Aprobar con comentarios es válido solo si:
- No afectan comportamiento
- No afectan arquitectura
- No introducen riesgos

**Ejemplo:**

- Nombres
- Comentarios
- Orden menor de código

## Discusión y desacuerdos
Las discusiones dentro de un Pull Request son esperadas y saludables.
Un PR sin discusión no siempre es señal de calidad; muchas veces es señal de revisión superficial.

El objetivo de una discusión no es ganar, ni imponer una opinión, sino mejorar la solución técnica y reducir riesgos futuros.

### Naturaleza de una buena discusión técnica
Una discusión correcta debe centrarse en:

- Diseño
- Responsabilidades
- Impacto a largo plazo
- Mantenibilidad
- Consistencia con la arquitectura

Y no en:

- Preferencias personales
- Estilo subjetivo sin impacto
- “Siempre lo hemos hecho así”
- Autoridad o seniority
- El argumento válido en una discusión es técnico, no jerárquico.

### Ejemplo de discusión correcta

**Comentario del revisor:**

> Esta lógica de validación vive en el controller.
> ¿Hay alguna razón para no moverla al dominio?

Respuesta correcta del autor:

> Buena observación. Inicialmente lo dejé en el controller por rapidez,
> pero coincido en que pertenece al dominio.
> Voy a moverlo y ajustar los tests.

**Aquí:**

- No hay ataque personal
- Se cuestiona el diseño, no al autor
- Se llega a una mejora concreta

**Ejemplo incorrecto**

Comentario:
> "Yo siempre lo hago así y nunca ha fallado.""

Esto:

- No aporta criterio técnico
- Bloquea el aprendizaje
- No escala en equipos grandes

